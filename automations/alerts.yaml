# Those automations are meant to alert me if something weird is going on, eg. an
# abnormal temperature.
#
# There are currently only 2 automations:
# * `Alert me if the temperature is too low`: In case the temperature in any of
#   the indoor rooms (including the basement) goes below 10 degrees, alert me
#   through Google Chat and my Google Homes.
# * `Alert me if the temperature is too high`: Same if the temperature goes over
#   30 (to be tweaked since I think it happens quite frequently in summer)
#
# I also used to have automations related to noise and moisture but they were
# using my [Minut Point](minut.com) devices but since I can't inteface them with
# HA I had to get rid of the automations. I also used to have 2 automations
# related to my freezer, using a door sensor because my daughter used to forget
# to close it, but I now have a new freezer which beeps so I also disabled the
# automations. I'm still keeping them all here as reference.

- id: alert_temperature_low
  alias: Alert me if the temperature is too low
  trigger:
    - platform: numeric_state
      entity_id: sensor.backkitchen_temperature, sensor.flood_sensor_basement_temperature, sensor.flood_sensor_kitchen_temperature, sensor.office_button_temperature, sensor.temperature_sous_sol, sensor.aurore_bedroom_temperature, sensor.bathroom_temperature, sensor.shower_temperature, sensor.playroom_temperature, sensor.basement_temperature, sensor.valve_salon_current_temperature
      below: 10
  action:
    - service: rest_command.gchatalert
      data:
        text: Température basse!
    - service: tts.google_say
      entity_id: "all"
      data:
        message: La température est trop basse
- id: alert_temperature_high
  alias: Alert me if the temperature is too high
  trigger:
    - platform: numeric_state
      entity_id: sensor.backkitchen_temperature, sensor.flood_sensor_basement_temperature, sensor.flood_sensor_kitchen_temperature, sensor.office_button_temperature, sensor.temperature_sous_sol, sensor.aurore_bedroom_temperature, sensor.bathroom_temperature, sensor.shower_temperature, sensor.playroom_temperature, sensor.basement_temperature, sensor.valve_salon_current_temperature
      above: 30
  action:
    - service: rest_command.gchatalert
      data:
        text: Température hyper haute!
    - service: tts.google_say
      entity_id: "all"
      data:
        message: Il fait super chaud!
# - id: alert_noise
#   alias: Alert me if the minut detects noise
#   trigger:
#     - platform: state
#       entity_id: binary_sensor.solarium_heat, binary_sensor.living_room_heat
#       to: "on"
#   action:
#     - service: rest_command.gchatalert
#       data:
#         text: Canicule detectée!
# - id: alert_moisture
#   alias: Alert me if the minut detects moisture
#   trigger:
#     - platform: state
#       entity_id: binary_sensor.solarium_moisture, binary_sensor.living_room_moisture
#       to: "on"
#   action:
#     - service: rest_command.gchatalert
#       data:
#         text: Risque de moisisure detectée!
# - id: alert_button pressed
#   alias: Alert me if the minut is pressed
#   trigger:
#     - platform: state
#       entity_id: binary_sensor.solarium_button_press, binary_sensor.living_room_button_press, binary_sensor.living_room_button_press_2
#       to: "on"
#   action:
#     - service: rest_command.gchat
#       data:
#         text: Bouton du minut pressé!
# - id: FreezerLeftOpen
#   alias: Freezer left open for more than 10mn
#   trigger:
#     - platform: state
#       entity_id: binary_sensor.freezer_door
#       to: "on"
#       for: "0:10:00"
#   action:
#     - service: light.turn_on
#       data:
#         effect: "Police2"
#       entity_id: light.basement_corridor
#     - service: tts.google_say
#       entity_id: "all"
#       data:
#         message: Attention, le congélateur est resté ouvert !
#     - service: rest_command.gchatalert
#       data:
#         text: Attention, le congélateur est resté ouvert !
- id: '1666186950016'
  alias: Test Nest sonnette
  description: ''
  trigger:
  - platform: device
    device_id: 033b8589dd583f9142b48bd463dcccd0
    domain: nest
    type: doorbell_chime
  - platform: device
    device_id: 033b8589dd583f9142b48bd463dcccd0
    domain: nest
    type: camera_person
    enabled: false
  - platform: device
    device_id: 033b8589dd583f9142b48bd463dcccd0
    domain: nest
    type: camera_motion
    enabled: false
  condition: []
  action:
  - service: rest_command.gchat
    data:
      text: Sonette pressée!
  mode: single
- id: '1687949528073'
  alias: Close water if a leak is detected
  description: ''
  trigger:
  - type: moist
    platform: device
    device_id: dd451c8daffe059f22ccc2209342cbc2
    entity_id: binary_sensor.flood_detector_basement_flood
    domain: binary_sensor
  condition: []
  action:
  - type: turn_off
    device_id: 95c85383ea986cdfab0a3fe9c33f7a49
    entity_id: light.vanne_light
    domain: light
  mode: single
- id: '1688126732710'
  alias: 'Sécurité: couper l''eau si une fuite est détectée (pour l''instant dans
    le jardin)'
  description: ''
  trigger:
  - type: humidity
    platform: device
    device_id: cad5fd413dbabbb36bdee8579c03dab8
    entity_id: sensor.potager_soil_moisture
    domain: sensor
    above: 95
    for:
      hours: 0
      minutes: 15
      seconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.people_home
    state: 'off'
  action:
  - type: turn_off
    device_id: 95c85383ea986cdfab0a3fe9c33f7a49
    entity_id: light.vanne_light
    domain: light
  mode: single
- id: '1689543800532'
  alias: Flood detected
  description: ''
  trigger:
  - type: moist
    platform: device
    device_id: 2a230f2371c0d65ab5cc143dbd0b7df3
    entity_id: 4b6d3f99a99a0d92c0de91ac66d99384
    domain: binary_sensor
    id: flood_in_kitchen
  - type: moist
    platform: device
    device_id: dd451c8daffe059f22ccc2209342cbc2
    entity_id: 915a11f853df87ec87528861360129e7
    domain: binary_sensor
    id: flood_in_basement
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - flood_in_kitchen
      sequence:
      - service: rest_command.gchatalert
        data:
          text: Fuite dans la cuisine !
    - conditions:
      - condition: trigger
        id:
        - flood_in_basement
      sequence:
      - service: rest_command.gchatalert
        data:
          text: Fuite dans le sous-sol !
  - type: turn_off
    device_id: 95c85383ea986cdfab0a3fe9c33f7a49
    entity_id: light.vanne_light
    domain: light
  mode: single
- id: '1689544847933'
  alias: Conso anormale à La Plagne
  description: Alert if the heating still works while the resort should be closed
    and we're not there.
  trigger:
  - platform: numeric_state
    entity_id: sensor.myenedis_19677423985708
    for:
      hours: 1
      minutes: 0
      seconds: 0
    above: 2
  condition:
  - condition: not
    conditions:
    - condition: zone
      entity_id: person.guillaume
      zone: zone.la_plagne
    - condition: template
      value_template: '{% set n = now() %}

        {{ n.month < 12 and ( n.month > 5 or ( n.month == 5 and n.day <= 15 ) ) }}'
  action:
  - service: rest_command.gchat
    data:
      text: Chauffage en fonctionnement à La Plagne.
  mode: single
- id: '1697917560752'
  alias: 'Fuite au sous-sol '
  description: ''
  trigger:
  - type: moist
    platform: device
    device_id: 1182ddc99c6d86a6f5f82b0e05170b3f
    entity_id: 5cff1292faeb8ba8417017b5a3440c65
    domain: binary_sensor
    for:
      hours: 0
      minutes: 2
      seconds: 0
  - type: moist
    platform: device
    device_id: 2904f86b89a60a20afcf47e53bec80a8
    entity_id: 2c5888e5f268ec1d2ffc9720e0eb5849
    domain: binary_sensor
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: rest_command.gchatalert
    data:
      text: Fuite au sous-sol !!!
  - service: tts.google_say
    entity_id: all
    data:
      message: Fuite détectée !
  - service: notify.mobile_app_pixel_7_pro
    data:
      message: 'Fuite détectée '
      title: Fuite
  mode: single
- id: '1704463513006'
  alias: Alert when RPi power isn't enough
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.rpi_power_status
    to: 'on'
  condition: []
  action:
  - service: notify.mobile_app_pixel_7_pro
    metadata: {}
    data:
      message: Problème d'alimentaiton de la RPi
      title: ⚠️Alim
  - service: notify.slack
    metadata: {}
    data:
      title: ⚠️Alim
      message: Problème d'alimentaiton de la RPi
  - service: rest_command.gchatalert
    data:
      text: Problème d'alimentaiton de la RPi
  mode: single
- id: '1727272545121'
  alias: Office window opened while it rains
  description: ''
  trigger:
  - type: precipitation
    platform: device
    device_id: 67e35c5459774ea782ecdaa971168280
    entity_id: b77fbbed5b6243550d7e1547d1915a32
    domain: sensor
    above: 0.1
  condition:
  - condition: state
    entity_id: binary_sensor.velux_bureau_contact
    state: 'on'
  action:
  - action: notify.mobile_app_pixel_8_pro
    data:
      title: "\U0001F327️ Pluie dans le bureau"
      message: "Le velux est ouvert alors qu'il pleut \U0001F631"
  mode: single
- id: '1727285569924'
  alias: Alert when the water tank is too cold
  description: ''
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.temperature_ballon_haut
    for:
      hours: 1
      minutes: 0
      seconds: 0
    below: 40
  condition: []
  action:
  - action: notify.mobile_app_pixel_8_pro
    metadata: {}
    data:
      message: Chauffe-eau trop froid
  mode: single
# - id: FreezerAlreayOpenWhenBasementLightSwitchesOn
#   alias: Freezer opened for more than 10mn when light switches on
#   trigger:
#     - platform: state
#       entity_id: light.basement_corridor
#       to: "on"
#   condition:
#     - condition: state
#       entity_id: binary_sensor.freezer_door
#       state: "on"
#       for: "0:10:00"
#   action:
#     - service: light.turn_on
#       data:
#         effect: "Police2"
#       entity_id: light.basement_corridor
