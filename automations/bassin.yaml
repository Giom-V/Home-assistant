# Automations related to the pond's pump.
#
# There are 5 automations:
# * `Turn on the pond's pump during off-peak hours`: Turns on the pump when
#   off-peak hours start, but only if the temperature is above 0°C.
# * `Turn off the pond's pump during peak hours`: Turns off the pump when
#   peak hours start, or at 2 PM.
# * `Turn on pond's pump when we are here during lunch time`: Turns on the
#   pump at noon if someone is at home or if there are visitors.
# * `Turn on water pump for 5mn to scare animals`: If the presence sensor
#   detects something for 10s, and if we are not in a "red" day for electricity
#   and the gate is closed, then turn on the pump for 5 minutes. If we are in
#   peak hours, turn it off after 5 minutes.
# * `Turn off water pump when it's freezing`: Turns off the pump if the
#   temperature is below 0°C for 5 minutes.

- id: "1679262865155"
  alias: Turn on the pond's pump during off-peak hours
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.heure_creuse
      to: "on"
  condition:
    - condition: numeric_state
      entity_id: sensor.module_exterieur_netatmo_temperature
      above: 0
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.fontaine_bassin
  mode: single
- id: "1679262911117"
  alias: Turn off the pond's pump during peak hours
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.heure_creuse
      to: "off"
    - platform: time
      at: "14:00:00"
  condition: []
  action:
    - service: switch.turn_off
      target:
        entity_id: switch.fontaine_bassin
  mode: single
- id: "1685014375600"
  alias: Turn on pond's pump when we are here during lunch time
  description: ""
  trigger:
    - platform: time
      at: "12:00:00"
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_boolean.visitors
          state: "on"
        - condition: state
          entity_id: binary_sensor.people_home
          state: "on"
  action:
    - service: switch.turn_on
      entity_id: switch.pompe_switch
  mode: single
- id: "1713465676198"
  alias: Turn on water pump for 5mn to scare animals
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_bassin
      to: "on"
      for:
        seconds: 10
  condition:
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.rte_tempo_couleur_actuelle
          state: Rouge
    - condition: state
      entity_id: binary_sensor.portail_bassin
      state: "off"
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.fontaine_bassin
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
    - if:
        - condition: state
          entity_id: binary_sensor.heure_creuse
          state: "off"
      then:
        - service: switch.turn_off
          target:
            entity_id: switch.fontaine_bassin
  mode: restart
- id: "1736867866654"
  alias: Turn off water pump when it's freezing
  description: ""
  trigger:
    - platform: numeric_state
      entity_id: sensor.module_exterieur_netatmo_temperature
      below: 0
      for:
        minutes: 5
  condition: []
  action:
    - service: switch.turn_off
      target:
        entity_id: switch.fontaine_bassin
  mode: single
