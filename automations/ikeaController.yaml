- id: tradfri_remote_control_switch_off
  alias: Télécommande ikea - switch off
  trigger:
  - event_data:
      event: 1001
      id: tradfri_remote_control
    event_type: deconz_event
    platform: event
  - event_data:
      event: 1002
      id: tradfri_remote_control
    event_type: deconz_event
    platform: event
  condition:
  - condition: state
    entity_id: light.colorv2
    state: 'on'
  action:
  - entity_id:
    - light.colorv2
    - light.color
    - light.white
    service: light.turn_off
  initial_state: 'on'
- id: tradfri_remote_control_switch_on
  alias: Télécommande ikea - switch on
  trigger:
  - event_data:
      event: 1002
      id: tradfri_remote_control
    event_type: deconz_event
    platform: event
  condition:
  - condition: state
    entity_id: light.colorv2
    state: 'off'
  action:
  - entity_id:
    - light.colorv2
    - light.color
    - light.white
    service: light.turn_on
  initial_state: 'on'
- id: tradfri_remote_control_increase_brightness
  alias: Télécommande ikea - increase brightness
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 2001
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 2002
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.colorv2
      brightness: '{% set bri = state_attr(''light.colorv2'', ''brightness'') | int
        %} {{ [bri * 2, 255] | min }}'
  - service: light.turn_on
    data_template:
      entity_id: light.color
      brightness: '{% set bri = state_attr(''light.color'', ''brightness'') | int
        %} {{ [bri * 2, 255] | min }}'
  - service: light.turn_on
    data_template:
      entity_id: light.white
      brightness: '{% set bri = state_attr(''light.white'', ''brightness'') | int
        %} {{ [bri * 2, 255] | min }}'
- id: tradfri_remote_control_decrease_brightness
  alias: Télécommande ikea - decrease brightness
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 3001
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 3002
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.colorv2 #TODO: passer direct de 1 à 16
      brightness: '{% set bri = state_attr(''light.colorv2'', ''brightness'') | float
        %} {% set half_bri = bri / 2 %} {{ half_bri | round(0, "ceil") | int }}'
  - service: light.turn_on
    data_template:
      entity_id: light.color
      brightness: '{% set bri = state_attr(''light.color'', ''brightness'') | float
        %} {% set half_bri = bri / 2 %} {{ half_bri | round(0, "ceil") | int }}'
  - service: light.turn_on
    data_template:
      entity_id: light.white
      brightness: '{% set bri = state_attr(''light.white'', ''brightness'') | float
        %} {% set half_bri = bri / 2 %} {{ half_bri | round(0, "ceil") | int }}'
- id: tradfri_remote_control_decrease_brightness_hold
  alias: Télécommande ikea - decrease brightness hold
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 3003 # hold then release brightness decrease button
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 5003 # hold then release right button
  action:
  - service_template: "light.turn_{{ 'on' if is_state('light.white','on') or is_state('light.colorv2','off') else 'off' }}"
    entity_id: light.white
    data:
      brightness: 1 #TODO: change for a data template to remove an error
  - entity_id:
    - light.colorv2
    - light.color
    service: light.turn_on
    data:
      brightness: 1
- id: tradfri_remote_control_left_arrow
  alias: Télécommande ikea - left button
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 4001
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 4002
  action:
  - service: scene.turn_on
    entity_id: scene.WhiteLivingRoom
- id: tradfri_remote_control_right_arrow
  alias: Télécommande ikea - right button
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 5001
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 5002
  action:
  - service: script.turn_on
    entity_id: script.switch_living_room_color
- id: tradfri_remote_control_hold_for_max_bightness
  alias: Télécommande ikea - hold for max bightness
  trigger:
  - event_data:
      event: 1001 # hold then release toggle button
      id: tradfri_remote_control
    event_type: deconz_event
    platform: event
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 2003 # hold then release brightness increase button
  - platform: event
    event_type: deconz_event
    event_data:
      id: tradfri_remote_control
      event: 4003 # hold then release left button
  action:
  - service_template: "light.turn_{{ 'on' if is_state('light.white','on') or is_state('light.colorv2','off') else 'off' }}"
    entity_id: light.white
    data:
      brightness: 255 #TODO: change for a data template to remove an error
  - entity_id:
    - light.colorv2
    - light.color
    service: light.turn_on
    data:
      brightness: 255
  initial_state: 'on'
- id: living_room_color
  alias: Change Living room color
  trigger:
  - platform: state
    entity_id: input_select.living_room_color
  action:
  - service: script.living_room_color