# Automations related to our apartment in Cannes.
#
# There are 2 automations:
# * `Cannes: Someone using the lights`: Notifies us if the lights are being used
#   while we are not there.
# * `Porte placard privé Cannes ouverte`: Notifies us if the private closet door
#   is opened while we are not there.

- id: "cannes_lights_on_when_absent"
  alias: "Cannes: Someone using the lights"
  description: "Notifies us if the lights in Cannes are turned on when we are not there."
  trigger:
    - platform: state
      entity_id:
        - light.cannes_lumiere_cuisine
        - light.cannes_lumiere_salle_a_manger
  conditions:
    - condition: not
      conditions:
        - condition: or
          conditions:
            - condition: zone
              entity_id: person.claire
              zone: zone.cannes
            - condition: zone
              entity_id: person.guillaume
              zone: zone.cannes
            - condition: zone
              entity_id: person.pascal
              zone: zone.cannes
      enabled: true
  actions:
    - variables:
        message_text: "Un locataire est en train de jouer avec les lumières de Cannes."
    - service: rest_command.gchat
      data:
        text: "{{ message_text }}"
    - service: notify.mobile_app_pixel_9_xl
      data:
        message: "{{ message_text }}"
        title: Cannes
    - service: notify.mobile_app_pixel_7q_pascal
      data:
        message: "{{ message_text }}"
        title: Cannes
    - service: notify.mobile_app_pixel_8a_jacqueline
      data:
        message: "{{ message_text }}"
        title: Cannes
  mode: single
- id: "cannes_private_closet_opened"
  alias: Porte placard privé Cannes ouverte
  description: "Notifies us if the private closet door in Cannes is opened when we are not there."
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.placard_prive_door
      to: "on"
  conditions:
    - condition: not
      conditions:
        - condition: or
          conditions:
            - condition: zone
              entity_id: person.claire
              zone: zone.cannes
            - condition: zone
              entity_id: person.guillaume
              zone: zone.cannes
            - condition: zone
              entity_id: person.pascal
              zone: zone.cannes
      enabled: true
  actions:
    - variables:
        message_text: "Porte placard Cannes ouverte !"
        gchat_message_text: "Un locataire a ouvert le placard de Cannes."
    - service: notify.mobile_app_pixel_9_pro_xl
      data:
        message: "{{ message_text }}"
        title: Cannes
    - service: notify.mobile_app_pixel_7a_pascal
      data:
        message: "{{ message_text }}"
        title: Cannes
    - service: notify.mobile_app_pixel_8a_jacqueline
      data:
        message: "{{ message_text }}"
        title: Cannes
    - service: notify.notify
      data:
        message: "{{ message_text }}"
        title: Cannes
      enabled: false
    - service: rest_command.gchat
      data:
        text: "{{ gchat_message_text }}"
  mode: single
