{"version":3,"file":"panel-wrapper.js","sources":["../../src/panel-wrapper.ts"],"sourcesContent":["/**\n * Minimal wrapper for Home Assistant panel integration.\n * This web component receives the hass object from HA, exposes it on window,\n * and loads the actual app in an iframe for proper document isolation.\n */\nimport type { HomeAssistant } from './types/hass';\n\n// Type for window with hass\ndeclare const window: Window & {\n  hass?: HomeAssistant;\n};\n\nclass CafePanelWrapper extends HTMLElement {\n  private _messageHandler?: (event: MessageEvent) => void;\n  private iframe: HTMLIFrameElement | null = null;\n  private _hass: HomeAssistant | undefined = undefined;\n\n  // Properties that HA will set\n  set hass(value: HomeAssistant | undefined) {\n    this._hass = value;\n    // Expose hass on window so iframe can access via window.parent.hass\n    window.hass = value;\n  }\n\n  get hass() {\n    return this._hass;\n  }\n\n  connectedCallback() {\n    // Style the wrapper to fill the container\n    this.style.display = 'block';\n    this.style.width = '100%';\n    this.style.height = '100%';\n    this.style.position = 'relative';\n\n    // Create iframe pointing to the app\n    this.iframe = document.createElement('iframe');\n    this.iframe.src = '/cafe-hass/index.html';\n    this.iframe.style.width = '100%';\n    this.iframe.style.height = '100%';\n    this.iframe.style.border = 'none';\n    this.iframe.style.display = 'block';\n    // Allow same-origin access\n    this.iframe.setAttribute('allow', 'clipboard-read *; clipboard-write *');\n\n    this.appendChild(this.iframe);\n\n    // Listen for messages from the iframe to trigger sidebar toggle\n    this._messageHandler = (event: MessageEvent) => {\n      // Only accept messages from our iframe\n      if (event.source !== this.iframe?.contentWindow) return;\n      if (event.data && event.data.type === 'CAFE_TOGGLE_SIDEBAR') {\n        this.dispatchEvent(new Event('hass-toggle-menu', { bubbles: true, composed: true }));\n      }\n    };\n    window.addEventListener('message', this._messageHandler);\n  }\n\n  disconnectedCallback() {\n    if (this.iframe) {\n      this.removeChild(this.iframe);\n      this.iframe = null;\n    }\n    // Clean up window properties\n    window.hass = undefined;\n    if (this._messageHandler) {\n      window.removeEventListener('message', this._messageHandler);\n      this._messageHandler = undefined;\n    }\n  }\n}\n\n// Register the custom element\nif (!customElements.get('cafe-panel')) {\n  customElements.define('cafe-panel', CafePanelWrapper);\n}\n"],"names":["CafePanelWrapper","__publicField","value","event","_a"],"mappings":"oKAYA,MAAMA,UAAyB,WAAY,CAA3C,kCACUC,EAAA,wBACAA,EAAA,cAAmC,MACnCA,EAAA,cAGR,IAAI,KAAKC,EAAkC,CACzC,KAAK,MAAQA,EAEb,OAAO,KAAOA,CAChB,CAEA,IAAI,MAAO,CACT,OAAO,KAAK,KACd,CAEA,mBAAoB,CAElB,KAAK,MAAM,QAAU,QACrB,KAAK,MAAM,MAAQ,OACnB,KAAK,MAAM,OAAS,OACpB,KAAK,MAAM,SAAW,WAGtB,KAAK,OAAS,SAAS,cAAc,QAAQ,EAC7C,KAAK,OAAO,IAAM,wBAClB,KAAK,OAAO,MAAM,MAAQ,OAC1B,KAAK,OAAO,MAAM,OAAS,OAC3B,KAAK,OAAO,MAAM,OAAS,OAC3B,KAAK,OAAO,MAAM,QAAU,QAE5B,KAAK,OAAO,aAAa,QAAS,qCAAqC,EAEvE,KAAK,YAAY,KAAK,MAAM,EAG5B,KAAK,gBAAmBC,GAAwB,CApCpD,IAAAC,EAsCUD,EAAM,WAAWC,EAAA,KAAK,SAAL,YAAAA,EAAa,gBAC9BD,EAAM,MAAQA,EAAM,KAAK,OAAS,uBACpC,KAAK,cAAc,IAAI,MAAM,mBAAoB,CAAE,QAAS,GAAM,SAAU,EAAA,CAAM,CAAC,CAEvF,EACA,OAAO,iBAAiB,UAAW,KAAK,eAAe,CACzD,CAEA,sBAAuB,CACjB,KAAK,SACP,KAAK,YAAY,KAAK,MAAM,EAC5B,KAAK,OAAS,MAGhB,OAAO,KAAO,OACV,KAAK,kBACP,OAAO,oBAAoB,UAAW,KAAK,eAAe,EAC1D,KAAK,gBAAkB,OAE3B,CACF,CAGK,eAAe,IAAI,YAAY,GAClC,eAAe,OAAO,aAAcH,CAAgB"}