#TODO: add number of times

vacuum_dispatch:
  alias: "Vacuum Dispatch"
  sequence:
    - service: system_log.write
      data_template:
        message: "Text received to dispatch Robbie: {{ room|lower }}"
        level: error
        logger: script.vacuum_dispatch
    - service_template: >
        {% if "cuisine" in room|lower %}
          {% if "manger" in room|lower %}
            script.vacuum_kitchen_and_diningroom
          {% elif "table" in room|lower %}
            script.vacuum_kitchen_and_diningroom
          {% else %}
            script.vacuum_kitchen
          {% endif %}
        {% elif "kitchen" in room|lower %}
          {% if "dining" in room|lower %}
            script.vacuum_kitchen_and_diningroom
          {% elif "table" in room|lower %}
            script.vacuum_kitchen_and_diningroom
          {% else %}
            script.vacuum_kitchen
          {% endif %}
        {% elif "manger" in room|lower %}
          script.vacuum_diningroom
        {% elif "repas" in room|lower %}
          script.vacuum_diningroom
        {% elif "dining" in room|lower %}
          script.vacuum_diningroom
        {% elif "table" in room|lower %}
          script.vacuum_diningroom
        {% elif "bain" in room|lower %}
          script.vacuum_bathroom
        {% elif "toilet" in room|lower %}
          script.vacuum_bathroom
        {% elif "bath" in room|lower %}
          vacuum_bathroom
        {% elif "chambre" in room|lower %}
          {% if "aurore" in room|lower %}
            script.vacuum_aurore_bedroom
          {% elif "enfant" in room|lower %}
            script.vacuum_aurore_bedroom
          {% elif "petite" in room|lower %}
            script.vacuum_aurore_bedroom
          {% else %}
            script.vacuum_bedroom
          {% endif %}
        {% elif "bedroom" in room|lower %}
          {% if "aurore" in room|lower %}
            script.vacuum_aurore_bedroom
          {% elif "kid" in room|lower %}
            script.vacuum_aurore_bedroom
          {% elif "small" in room|lower %}
            script.vacuum_aurore_bedroom
          {% else %}
            script.vacuum_bedroom
          {% endif %}
        {% elif "aurore" in room|lower %}
          script.vacuum_aurore_zone
        {% elif "salon" in room|lower %}
          script.vacuum_livingroom
        {% elif "canapé" in room|lower %}
          script.vacuum_livingroom
        {% elif "living" in room|lower %}
          script.vacuum_livingroom
        {% elif "entrée" in room|lower %}
          script.vacuum_entry
        {% elif "couloir" in room|lower %}
          script.vacuum_hallway
        {% else %}
          script.vacuum_diningroom
        {% endif %}
      data_template:
        times: '{% set times = 1 %}
          {% if "2 fois" in room|lower %}
            {% set times = 2 %}
          {% elif "deux fois" in room|lower %}
            {% set times = 2 %}
          {% elif "2 times" in room|lower %}
            {% set times = 2 %}
          {% elif "two times" in room|lower %}
            {% set times = 2 %}
          {% elif "twice" in room|lower %}
            {% set times = 2 %}
          {% elif "3 fois" in room|lower %}
            {% set times = 3 %}
          {% elif "trois fois" in room|lower %}
            {% set times = 3 %}
          {% elif "3 times" in room|lower %}
            {% set times = 3 %}
          {% elif "three times" in room|lower %}
            {% set times = 3 %}
          {% endif %}
          {{ times }}'
vacuum_kitchen:
  alias: "Vacuum Kitchen"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[24460,28231,27410,30481]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [16]
vacuum_kitchen_and_diningroom:
  alias: "Vacuum Kitchen and Diningroom"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: 
          - [24430,24904,28030,28254]
          - [24460,28231,27410,30481]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [16,17]
vacuum_diningroom:
  alias: "Vacuum Dining Room"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[24430,24904,28030,28254]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [17]
vacuum_bathroom:
  alias: "Vacuum Bathroom"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[24603,31125,28203,32875]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [22]
vacuum_bedroom:
  alias: "Vacuum Bedroom"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[19934,33218,24084,36768]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [24]
vacuum_aurore_bedroom:
  alias: "Vacuum Aurore's Bedroom"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[24435,33236,28135,36936]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [23]
vacuum_livingroom:
  alias: "Vacuum Living Room"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[20239,24800,24439,28100]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [18]
vacuum_aurore_zone:
  alias: "Vacuum Aurore's zone"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[20188,31271,22438,33321]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [19]
vacuum_entry:
  alias: "Vacuum Entry"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[20157,28076,23757,31026]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [19]
vacuum_hallway:
  alias: "Vacuum Hallway"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: xiaomi_miio.vacuum_clean_zone
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        repeats: >
          {% set vacuum_times = 1 %}
          {% if times is defined %}
           {% set vacuum_times = times %}
          {% endif %}
          {{vacuum_times}}
        zone: [[23340,28034,24440,34284]]
    # - service: vacuum.send_command # Alternative
    #     entity_id: vacuum.xiaomi_vacuum_cleaner
    #     command: app_segment_clean
    #     params: [19]
vacuum_reset_fan_speed_after_mopping: # This might be automatically managed by the vacuum (TODO: verify)
  alias: "Reset vacuum's fan speed after mopping"
  sequence:
    - delay:
        minutes: 1
    - wait_template: "{{ is_state('vacuum.xiaomi_vacuum_cleaner', 'docked') }}"
    - service: vacuum.set_fan_speed
      data:
        fan_speed: Standard
        entity_id: vacuum.xiaomi_vacuum_cleaner
mop_bathroom:
  alias: "Mop Bathroom"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: vacuum.set_fan_speed
      data:
        fan_speed: Gentle
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: script.vacuum_bathroom
      data_template:
        times: '{{ times }}'
    - service: script.turm_on
      data:
        entity_id: script.vacuum_reset_fan_speed_after_mopping
mop_kitchen:
  alias: "Mop Kitchen"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: vacuum.set_fan_speed
      data:
        fan_speed: Gentle
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: script.vacuum_kitchen
      data_template:
        times: '{{ times }}'
    - service: script.turm_on
      data:
        entity_id: script.vacuum_reset_fan_speed_after_mopping
mop_diningroom:
  alias: "Mop Diningroom"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: vacuum.set_fan_speed
      data:
        fan_speed: Gentle
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: script.vacuum_diningroom
      data_template:
        times: '{{ times }}'
    - service: script.turm_on
      data:
        entity_id: script.vacuum_reset_fan_speed_after_mopping
mop_kitchen_and_dining_room:
  alias: "Mop Kitchen and dining room"
  sequence:
    - service: vacuum.stop
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: vacuum.set_fan_speed
      data:
        fan_speed: Gentle
        entity_id: vacuum.xiaomi_vacuum_cleaner
    - service: script.vacuum_kitchen_and_diningroom
      data_template:
        times: '{{ times }}'
    - service: script.turm_on
      data:
        entity_id: script.vacuum_reset_fan_speed_after_mopping
